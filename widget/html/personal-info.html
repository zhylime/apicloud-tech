<!-- 个人信息 -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>个人信息</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../wgt/aui/css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/components/_search.css"/>
    <link rel="stylesheet" type="text/css" href="../css/components/_content.css"/>
    <link rel="stylesheet" type="text/css" href="../css/pages/_my.css"/>
    <style type="text/css">
    html,
    body {
        height: 100%;
    }
    
    section {
        position: relative;
        height: auto;
        margin-top: 8px;
        overflow: hidden;
        background-color: #fff;
    }
    
    .row {
        position: relative;
        box-sizing: borderbox;
        height: 49px;
        border-top: 1px solid #eee;
    }
    
    .title {
        position: relative;
        width: 100%;
        height: 48px;
        box-sizing: border-box;
        padding-left: 16px;
        padding-right: 48px;
        font-size: 16px;
        text-align: left;
        line-height: 48px;
    }
    
    .value {
        position: absolute;
        top: 0;
        right: 48px;
        height: 48px;
        font-size: 14px;
        text-align: right;
        line-height: 48px;
        color: #888;
    }
    .notification {
      top: 10px;
      right: 16px;
    }
    
    .arrow {
        position: absolute;
        top: 14px;
        right: 16px;
        width: 16px;
        height: 20px;
        background-size: 16px 20px;
        background-repeat: no-repeat;
        background-position: center 0;
        background-image: url(../image/arrow.png);
    }
    
    .avatar {
        margin-top: 0;
    }
    
    .avatar .row {
        height: 85px;
    }
    
    .avatar .title {
        top: 24px;
        padding-right: 112px;
    }
    
    .avatar .picture {
        position: absolute;
        top: 16px;
        right: 48px;
        width: 64px;
        height: 64px;
        background-size: 64px 64px;
        background-repeat: no-repeat;
        background-position: center 0;
        background-image: url(../image/profile_default.png);
    }
    
    .avatar .arrow {
        top: 38px;
    }
    
    .active {
        -webkit-opacity: 0.7;
        opacity: 0.7;
    }
    
    .logout {
        width: 100%;
        position: absolute;
        left: 0px;
        bottom: 10px;
    }
    
    .btn {
        margin: 3px 10px;
        background: #42a3f8;
        height: 40px;
        line-height: 40px;
        text-align: center;
        font-size: 20px;
        margin-top: 20px;
        border-radius: 5px;
        color: #fff;
    }
    
    .highlight {
        opacity: 0.7;
    }
    .aui-switch:checked {
        border-color: #54d66a;
        background-color: #54d66a;
    }
    .aui-grid
    {
        border-bottom: 1px solid #e5e5e5;
    }
    .aui-radio, .aui-checkbox {
        width: .9rem;
        height: .9rem;
    }
    .aui-list .aui-list-item-input {
        padding-right: 0;
    }
    .frame_container {
        padding-top: 0;
    }
    .color-blue {
        color: #3ca2fc;
    }
    .aui-list-item {
        font-size: .8rem;
        border-bottom: 1px solid #e5e5e5!important;
        padding: .5rem 0!important;
    }
    .aui-list label {
        line-height: .9rem;
    }
  </style>
</head>
<body class="frame_container">
  <header>
    <div class="aui-grid">
      <div class="aui-col-xs-2 aui-text-left aui-padded-l-10"><i class="tech-icon_jiantou" onclick="closeFrame('personal-info')"></i></div>
      <div class="aui-col-xs-8">个人信息</div>

    </div>
  </header>
  <section class="avatar">
            <div class="row" tapmode="highlight" onclick="fnSetAvatar();">
                <div class="title">我的头像</div>
                <div id="avatar" class="picture"></div>
                <div class="arrow"></div>
            </div>
        </section>
        <section class="profile">
            <div class="row" tapmode="highlight">
                <div class="title">
                    昵称
                </div>
                <div id="nick" class="value">豆粉0987372</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight" onclick="fnSetGender();">
                <div class="title">
                    性别
                </div>
                <div id="gender" class="value">未设置</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight" onclick="fnSetBirthday();">
                <div class="title">
                    生日
                </div>
                <div id="birthday" class="value">未设置</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight">
                <div class="title">
                    职业
                </div>
                <div id="career" class="value">未设置</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight">
                <div class="title">
                    学校/单位
                </div>
                <div id="school" class="value">未设置</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight">
                <div class="title">
                    个性签名
                </div>
                <div id="signature" class="value">未设置</div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight">
                <div class="title">
                    意见反馈
                </div>
                <div id="feedback" class="value"></div>
                <div class="arrow"></div>
            </div>
            <div class="row" tapmode="highlight">
                <div class="title">
                    消息推送
                </div>
                <div id="notification" class="value notification">
                  <input type="checkbox" class="aui-switch" checked="">
                </div>
            </div>
        </section>
        <section class="logout">
            <div class="btn" tapmode="highlight" onclick="fnLogout();">退出登录</div>
        </section>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">

    apiready = function() {
        fnInit();
        fnInitEvent();
        fnSetInfo();
    };

    function fnInitEvent() {
        api.addEventListener({
            name: 'cityChange'
        }, function(ret, err) {
            fnSetInfo();
        });
    };

    function fnInit() {
        avatar = $api.byId('avatar');
        gender = $api.byId('gender');
        birthday = $api.byId('birthday');
    };

    function fnSetInfo() {
        if($api.getStorage('avatar')){
          avatar.style.backgroundImage = 'url(' + $api.getStorage('avatar') + ')'
        } else {
          avatar.style.backgroundImage = 'url(../image/profile_default.png)';
        }

        gender.innerHTML = $api.getStorage('gender') || '';
        birthday.innerHTML = $api.getStorage('birthday') || '';


        api.sendEvent({
            name: 'setuserinfo'
        });
    };

    function fnSetAvatar() {
        api.actionSheet({
            cancelTitle: '取消',
            buttons: ['拍照', '打开相册']
        }, function(ret, err) {
            if (ret.buttonIndex == 3) {
                return;
            }

            var sourceType = (ret.buttonIndex == 1) ? 'camera' : 'album';

            api.getPicture({
                sourceType: sourceType,
                allowEdit: true,
                quality: 50,
                targetWidth: 100,
                targetHeight: 100
            }, function(ret, err) {
                if (ret && ret.data) {
                    $api.setStorage('avatar', ret.data);
                    fnSetInfo();
                }
            });
        });
    };

    function fnSetGender() {
        var buttons = ['男', '女'];
        api.actionSheet({
            title: '请选择',
            cancelTitle: '取消',
            buttons: buttons
        }, function(ret, err) {
            if (3 == ret.buttonIndex) {
                return;
            }

            $api.setStorage('gender', buttons[ret.buttonIndex - 1]);
            fnSetInfo();
        });
    };

    function fnSetBirthday() {
        api.openPicker({
            type: 'date',
            date: birthday.innertHTML,
            title: '日期'
        }, function(ret, err) {
            $api.setStorage('birthday', ret.year + '-' + ret.month + '-' + ret.day);
            fnSetInfo();
        });
    };


    function fnLogout() {
        $api.rmStorage('accessToken');
        $api.rmStorage('account');
        $api.rmStorage('gender');
        $api.rmStorage('birthday');
        $api.rmStorage('avatar');

        api.sendEvent({
            name: 'logout'
        });

        api.alert({
            title: '注销',
            msg: '已退出当前账号'
        });

        api.closeWin();
    };
</script>
</html>
